之前在做游戏的时候视野做的比较简单，每个玩家身上有个坐标，玩家移动的时候会找以自己为中心，周边辐射 x 距离的其他玩家。这种方法虽然简单，但玩家多的情况下，要遍历这个地图中的所有玩家。而且玩家身上的坐标更新的比较频繁，一方面要计算可视范围内其他玩家，一方面要发包给可视范围内的玩家，性能比较差。    
后来了解了下常用的几种计算可视范围的方法，记录一下：
### 网格(灯塔、网格)
将地图划分若干块，每小块记录当前块内玩家，其他玩家到这块来则记录该玩家，其他块删除该玩家。
<img width="300px" src="https://pic.downk.cc/item/5e54c7b56127cc07139c8eaa.png" alt="">
这个图好像没啥用
    
当然对于优化进出玩家的是有更好的算法的，这里先不说。

### 十字链表(目前用的比较多且性能较好的)
核心思想也是以玩家为中心计算可视范围，不过是用双链表实现的，效率会比粗暴的遍历所有玩家好很多，具体实现可以看[这篇文章](https://www.cnblogs.com/rond/p/6114919.html)。写的非常详细。

### 其他
以上几种方法只是简单的说明服务器场景实现，还有很多地方需要注意，比如某一场景有大量玩家，一个玩家移动要广播给999个玩家，那两个玩家移动要广播给 999^2个玩家，这里的io开销是非常巨大的，那是不是需要对场景内玩家状态做冷热处理呢，哪些状态需要广播，哪些状态不需要广播。哪些状态是队列广播，哪些状态要同步广播，这些都需要根据具体的业务需要去做优化。

### 分布式广播
这个和视野没啥关系了，不过可以用这种方法分摊服务器负载，提高广播人数，具体的需要把状态和链接分离开，广播可以广播给几台负责保持链接的服务器上，服务器再发布出去。之前写了一半的服务器框架也用了这种方法提高负载。
